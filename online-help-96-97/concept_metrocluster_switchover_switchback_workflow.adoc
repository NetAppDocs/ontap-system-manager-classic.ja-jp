---
permalink: online-help-96-97/concept_metrocluster_switchover_switchback_workflow.html 
sidebar: sidebar 
keywords: metrocluster, switchover, switchback, workflow, online, help, offline, maintenance 
summary: System Manager 9.6 以降では、災害によってソースクラスタ内のすべてのノードの電源がオフになって到達不能になった場合、 MetroCluster スイッチオーバー / スイッチバックの処理を使用できます。ディザスタリカバリのテストを実施する場合やメンテナンスのためにサイトをオフラインにする場合には、ネゴシエート（計画的）スイッチオーバーのワークフローを使用することもできます。 
---
= MetroCluster のスイッチオーバーとスイッチバックについて
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP System Manager 9.6 以降では、災害によってソースクラスタ内のすべてのノードの電源がオフになって到達不能になった場合、 MetroCluster スイッチオーバー / スイッチバックの処理を使用できます。ディザスタリカバリのテストを実施する場合やメンテナンスのためにサイトをオフラインにする場合には、ネゴシエート（計画的）スイッチオーバーのワークフローを使用することもできます。



== MetroCluster のスイッチオーバーとスイッチバックについて

System Manager 9.6 以降では、 MetroCluster スイッチオーバー / スイッチバックの処理を使用して別のクラスタサイトのタスクをテイクオーバーできます。メンテナンス時や災害からのリカバリ時に便利な機能です。

スイッチオーバー処理を使用すると、通常は別のクラスタ（サイト B ）が実行するタスクをクラスタ（サイト A ）がテイクオーバーできます。スイッチオーバー後、テイクオーバーされたクラスタ（サイト B ）を停止して、メンテナンスや修復を実施できます。メンテナンスが完了し、サイト B が稼働して修復タスクが完了したら、スイッチバック処理を開始して修復されたクラスタ（サイト B ）で通常のタスクを再開できます。

System Manager では、リモートクラスタサイトのステータスに基づいて 2 種類のスイッチオーバー処理がサポートされます。

* ネゴシエート（計画的）スイッチオーバー：この処理は、クラスタで計画的なメンテナンスを実施する場合や、ディザスタリカバリの手順をテストする場合に開始します。
* 計画外スイッチオーバー：この処理は、クラスタ（サイト B ）で災害が発生し、別のサイトまたはクラスタ（サイト A ）が災害の影響を受けたクラスタのタスクをテイクオーバーして修理とメンテナンスを実施する場合に開始します。


どちらのスイッチオーバー処理も、 System Manager で実行する手順は同じです。スイッチオーバーを開始すると、処理が可能かどうかが判断され、ワークロードが適宜調整されます。



== MetroCluster のスイッチオーバーとスイッチバックのワークフロー

スイッチオーバーとスイッチバックのワークフローは次の 3 つのフェーズで構成されます。

. * スイッチオーバー * ：スイッチオーバープロセスにより、ストレージおよびクライアントのアクセスの制御をソースクラスタサイト（サイト B ）から別のクラスタサイト（サイト A ）に移すことができます。この処理により、テストやメンテナンスの際のノンストップオペレーションが実現します。また、サイト障害からリカバリすることもできます。ディザスタリカバリのテストやサイトの計画的メンテナンスを実施する場合、 MetroCluster スイッチオーバーを実行して、ディザスタリカバリ（ DR ）サイト（サイト A ）に制御を移すことができます。スイッチオーバーを開始するには、 DR サイトの少なくとも 1 つのノードが稼働している必要があります。前回のスイッチオーバー処理が DR サイトの一部のノードで失敗している場合、それらのすべてのノードで処理を再試行できます。
. * サイト B の処理 * ：スイッチオーバーの完了後、 System Manager が MetroCluster IP 構成の修復プロセスを実行します。修復は計画的なイベントのため、各手順を細かく制御することでダウンタイムを最小限に抑えることができます。修復は、ストレージコンポーネントとコントローラコンポーネントで発生する 2 段階のプロセスで、スイッチバックプロセス用に修復されたサイトのノードを準備します。最初のフェーズでは、ミラーされたプレックスを再同期することでアグリゲートが修復され、災害サイトにスイッチバックすることでルートアグリゲートが修復されます。
+
2 番目のフェーズでは、サイトがスイッチバックプロセスに向けて準備されます。

. * スイッチバック * ：サイト B でメンテナンスや修復を実行したあと、スイッチバック処理を開始してストレージおよびクライアントアクセスの制御をサイト A からサイト B に戻しますスイッチバックが成功するためには、次の条件を満たしている必要があります。
+
** ホームノードおよびストレージシェルフの電源がオンになっていて、サイト A のノードから到達可能である必要があります
** スイッチバック処理を開始する前に System Manager による修復が完了している必要があります。
** サイト A のすべてのアグリゲートがミラーされた状態で、デグレードまたは再同期状態ではないことが必要です。
** スイッチバック処理を実行する前に、設定の変更がすべて完了している必要があります。これにより、ネゴシエートスイッチオーバーまたはスイッチバックの処理との競合が回避されます。






== MetroCluster スイッチオーバー / スイッチバックのワークフローフローチャート

次のフローチャートは、スイッチオーバーとスイッチバックの処理を開始した場合に発生するフェーズとプロセスを示しています。

image::../media/switchover_switchback_workflow.jpg[スイッチオーバーのスイッチバックワークフロー]
